// Generated by BUCKLESCRIPT, PLEASE EDIT WITH CARE

import * as $$Array from "bs-platform/lib/es6/array.js";
import * as Block from "bs-platform/lib/es6/block.js";
import * as Curry from "bs-platform/lib/es6/curry.js";
import * as React from "react";
import * as Card$BtsCore from "../../material-ui/core/Card/Card.bs.js";
import * as Data$BtsCore from "../../features/Data.bs.js";
import * as Avatar$BtsCore from "../../material-ui/core/Avatar/Avatar.bs.js";
import * as Status$BtsCore from "../../features/Status.bs.js";
import * as Axiosapi$BtsCore from "../../features/Axiosapi.bs.js";
import * as GridItem$BtsCore from "../../material-ui/core/Grid/GridItem.bs.js";
import * as Together$BtsCore from "../../styles/Together/Together.bs.js";
import * as Typography$BtsCore from "../../material-ui/core/Typography/Typography.bs.js";
import * as NewFacetube$BtsCore from "../../example/Facebook/NewFacetube.bs.js";
import * as ObjectFormat$BtsCore from "../../controls/ObjectFormat.bs.js";
import * as GridContainer$BtsCore from "../../material-ui/core/Grid/GridContainer.bs.js";
import * as SnackbarYoutube$BtsCore from "../../material-ui/core/Snackbar/SnackbarYoutube.bs.js";

((require('../../../scss/pages/Together/together.scss')));

function reducer(state, action) {
  if (typeof action === "number") {
    switch (action) {
      case /* SettingError */0 :
          return {
                  formLoad: state.formLoad,
                  formWidth: state.formWidth,
                  formHeight: state.formHeight,
                  showProgress: state.showProgress,
                  error: !state.error,
                  insert: state.insert,
                  update: state.update,
                  delete: state.delete,
                  export: state.export,
                  showItem: state.showItem,
                  itemCount: state.itemCount,
                  items: state.items,
                  showYoutube: state.showYoutube,
                  youtubeText: state.youtubeText
                };
      case /* SettingFormLoad */1 :
          return {
                  formLoad: !state.formLoad,
                  formWidth: state.formWidth,
                  formHeight: state.formHeight,
                  showProgress: state.showProgress,
                  error: state.error,
                  insert: state.insert,
                  update: state.update,
                  delete: state.delete,
                  export: state.export,
                  showItem: state.showItem,
                  itemCount: state.itemCount,
                  items: state.items,
                  showYoutube: state.showYoutube,
                  youtubeText: state.youtubeText
                };
      case /* ActionShowProgress */2 :
          return {
                  formLoad: state.formLoad,
                  formWidth: state.formWidth,
                  formHeight: state.formHeight,
                  showProgress: !state.showProgress,
                  error: state.error,
                  insert: state.insert,
                  update: state.update,
                  delete: state.delete,
                  export: state.export,
                  showItem: state.showItem,
                  itemCount: state.itemCount,
                  items: state.items,
                  showYoutube: state.showYoutube,
                  youtubeText: state.youtubeText
                };
      
    }
  } else {
    switch (action.tag | 0) {
      case /* SettingFormWidth */0 :
          return {
                  formLoad: state.formLoad,
                  formWidth: action[0],
                  formHeight: action[1],
                  showProgress: state.showProgress,
                  error: state.error,
                  insert: state.insert,
                  update: state.update,
                  delete: state.delete,
                  export: state.export,
                  showItem: state.showItem,
                  itemCount: state.itemCount,
                  items: state.items,
                  showYoutube: state.showYoutube,
                  youtubeText: state.youtubeText
                };
      case /* ActionPermissItems */1 :
          return {
                  formLoad: state.formLoad,
                  formWidth: state.formWidth,
                  formHeight: state.formHeight,
                  showProgress: state.showProgress,
                  error: state.error,
                  insert: action[0],
                  update: action[1],
                  delete: action[2],
                  export: action[3],
                  showItem: state.showItem,
                  itemCount: state.itemCount,
                  items: state.items,
                  showYoutube: state.showYoutube,
                  youtubeText: state.youtubeText
                };
      case /* SettingFormItems */2 :
          return {
                  formLoad: state.formLoad,
                  formWidth: state.formWidth,
                  formHeight: state.formHeight,
                  showProgress: state.showProgress,
                  error: state.error,
                  insert: state.insert,
                  update: state.update,
                  delete: state.delete,
                  export: state.export,
                  showItem: action[0],
                  itemCount: action[1],
                  items: action[2],
                  showYoutube: state.showYoutube,
                  youtubeText: state.youtubeText
                };
      case /* SettingScrollItems */3 :
          return {
                  formLoad: state.formLoad,
                  formWidth: state.formWidth,
                  formHeight: state.formHeight,
                  showProgress: state.showProgress,
                  error: state.error,
                  insert: state.insert,
                  update: state.update,
                  delete: state.delete,
                  export: state.export,
                  showItem: action[0],
                  itemCount: state.itemCount,
                  items: $$Array.append(state.items, action[1]),
                  showYoutube: state.showYoutube,
                  youtubeText: state.youtubeText
                };
      case /* ActionSnackBar */4 :
          return {
                  formLoad: state.formLoad,
                  formWidth: state.formWidth,
                  formHeight: state.formHeight,
                  showProgress: state.showProgress,
                  error: state.error,
                  insert: state.insert,
                  update: state.update,
                  delete: state.delete,
                  export: state.export,
                  showItem: state.showItem,
                  itemCount: state.itemCount,
                  items: state.items,
                  showYoutube: action[1],
                  youtubeText: action[0]
                };
      
    }
  }
}

var initialState_items = [];

var initialState = {
  formLoad: false,
  formWidth: 0,
  formHeight: 0,
  showProgress: true,
  error: false,
  insert: false,
  update: false,
  delete: false,
  export: false,
  showItem: false,
  itemCount: 0,
  items: initialState_items,
  showYoutube: false,
  youtubeText: ""
};

function Home(Props) {
  var match = React.useReducer(reducer, initialState);
  var dispatch = match[1];
  var state = match[0];
  var barShowRestoreAction = function (youtubeText) {
    Curry._1(dispatch, /* ActionSnackBar */Block.__(4, [
            youtubeText,
            true
          ]));
    setTimeout((function (param) {
            return Curry._1(dispatch, /* ActionSnackBar */Block.__(4, [
                          "",
                          false
                        ]));
          }), 5000);
    
  };
  var searchAJax = function (param) {
    Axiosapi$BtsCore.Default.search(Data$BtsCore.otherData(localStorage.getItem("newid"), String(state.items.length))).then((function (response) {
              var match = response.data.status;
              var tmp;
              if (match === "istrue") {
                Curry._1(dispatch, /* SettingFormItems */Block.__(2, [
                        response.data.showItem,
                        response.data.itemCount,
                        response.data.items
                      ]));
                tmp = Curry._1(dispatch, /* ActionShowProgress */2);
              } else {
                Curry._1(dispatch, /* SettingError */0);
                barShowRestoreAction(Status$BtsCore.statusModule(response.data.status));
                tmp = Curry._1(dispatch, /* ActionShowProgress */2);
              }
              return Promise.resolve(tmp);
            })).catch((function (error) {
            return Promise.resolve((console.log(error), undefined));
          }));
    
  };
  var permissAJax = function (param) {
    Axiosapi$BtsCore.Form.permiss(Data$BtsCore.userData(localStorage.getItem("newid"))).then((function (response) {
              return Promise.resolve((Curry._1(dispatch, /* ActionPermissItems */Block.__(1, [
                                  response.data.insert,
                                  response.data.update,
                                  response.data.delete,
                                  response.data.export
                                ])), searchAJax(undefined)));
            })).catch((function (error) {
            return Promise.resolve((console.log(error), undefined));
          }));
    
  };
  React.useEffect((function () {
          var match = state.formLoad;
          if (match) {
            return (function (param) {
                      console.log("action");
                      
                    });
          }
          Curry._1(dispatch, /* SettingFormLoad */1);
          Curry._1(dispatch, /* SettingFormWidth */Block.__(0, [
                  window.innerWidth,
                  window.innerHeight
                ]));
          var match$1 = ObjectFormat$BtsCore.checkObjects(sessionStorage.getItem("form"));
          var testId;
          var exit = 0;
          switch (match$1) {
            case "deleteSuccess" :
            case "saveSuccess" :
            case "sendSuccess" :
                exit = 1;
                break;
            default:
              console.log("action");
              testId = undefined;
          }
          if (exit === 1) {
            barShowRestoreAction(Status$BtsCore.statusModule(ObjectFormat$BtsCore.checkObjects(sessionStorage.getItem("form"))));
            sessionStorage.setItem("form", "");
            testId = undefined;
          }
          var timeId = permissAJax(undefined);
          return (function (param) {
                    return timeId;
                  });
        }));
  var handleResize = function ($$event) {
    return Curry._1(dispatch, /* SettingFormWidth */Block.__(0, [
                  $$event.currentTarget.innerWidth,
                  $$event.currentTarget.innerHeight
                ]));
  };
  React.useEffect((function () {
          window.addEventListener("resize", handleResize, true);
          return (function (param) {
                    
                  });
        }), ([]));
  React.useCallback((function (param) {
          Curry._1(dispatch, /* ActionShowProgress */2);
          var length = String(state.items.length);
          Axiosapi$BtsCore.Default.scroll(Data$BtsCore.otherData(length, localStorage.getItem("newid"))).then((function (response) {
                    return Promise.resolve((Curry._1(dispatch, /* SettingScrollItems */Block.__(3, [
                                        response.data.showItem,
                                        response.data.items
                                      ])), Curry._1(dispatch, /* ActionShowProgress */2)));
                  })).catch((function (error) {
                  return Promise.resolve((console.log(error), undefined));
                }));
          
        }));
  return React.createElement(React.Fragment, undefined, React.createElement(NewFacetube$BtsCore.make, {
                  showProgress: state.showProgress,
                  error: state.error,
                  children: React.createElement(GridItem$BtsCore.make, {
                        style: Together$BtsCore.marginAuto,
                        top: "0",
                        right: "32",
                        bottom: "0",
                        left: "32",
                        xs: "12",
                        children: React.createElement(GridContainer$BtsCore.make, {
                              direction: "column",
                              justify: "center",
                              alignItem: "stretch",
                              children: React.createElement(GridItem$BtsCore.make, {
                                    right: "24",
                                    bottom: "0",
                                    left: "24",
                                    xs: "auto",
                                    children: React.createElement(GridContainer$BtsCore.make, {
                                          direction: "row",
                                          justify: "start",
                                          alignItem: "center",
                                          children: $$Array.mapi((function (i, item) {
                                                  return React.createElement("div", undefined, React.createElement(GridItem$BtsCore.make, {
                                                                  style: {
                                                                    height: "250px",
                                                                    marginRight: "12px"
                                                                  },
                                                                  top: "0",
                                                                  right: "0",
                                                                  bottom: "0",
                                                                  left: "0",
                                                                  width: "276px",
                                                                  cursor: "pointer",
                                                                  enterBorderWidth: "2",
                                                                  borderWidth: "2",
                                                                  enterBorderColor: "rgba(255,0,0,0.8)",
                                                                  enterBorderRadius: "4",
                                                                  borderRadius: "1",
                                                                  xs: "no",
                                                                  children: React.createElement(Card$BtsCore.make, {
                                                                        children: React.createElement(GridContainer$BtsCore.make, {
                                                                              direction: "column",
                                                                              justify: "center",
                                                                              alignItem: "stretch",
                                                                              children: null
                                                                            }, React.createElement(GridItem$BtsCore.make, {
                                                                                  top: "0",
                                                                                  right: "0",
                                                                                  bottom: "0",
                                                                                  left: "0",
                                                                                  xs: "no",
                                                                                  children: React.createElement("div", {
                                                                                        style: {
                                                                                          height: "155px"
                                                                                        }
                                                                                      })
                                                                                }), React.createElement(GridItem$BtsCore.make, {
                                                                                  top: "0",
                                                                                  right: "12",
                                                                                  bottom: "0",
                                                                                  left: "16",
                                                                                  xs: "auto",
                                                                                  children: React.createElement(GridContainer$BtsCore.make, {
                                                                                        direction: "row",
                                                                                        justify: "center",
                                                                                        alignItem: "center",
                                                                                        children: null
                                                                                      }, React.createElement(GridItem$BtsCore.make, {
                                                                                            top: "0",
                                                                                            right: "0",
                                                                                            bottom: "0",
                                                                                            left: "0",
                                                                                            xs: "no",
                                                                                            children: React.createElement(Avatar$BtsCore.make, {
                                                                                                  top: "0",
                                                                                                  right: "12",
                                                                                                  bottom: "0",
                                                                                                  left: "0",
                                                                                                  color: "#909090",
                                                                                                  enterBorderColor: "transparent",
                                                                                                  downBorderColor: "transparent",
                                                                                                  backgroundColor: "rgba(0,0,0,0.08)",
                                                                                                  children: item.creator
                                                                                                })
                                                                                          }), React.createElement(GridItem$BtsCore.make, {
                                                                                            top: "0",
                                                                                            right: "0",
                                                                                            bottom: "0",
                                                                                            left: "0",
                                                                                            xs: "auto",
                                                                                            children: React.createElement(Typography$BtsCore.make, {
                                                                                                  variant: "subheading",
                                                                                                  noWrap: true,
                                                                                                  children: item.attribute
                                                                                                })
                                                                                          }))
                                                                                }), React.createElement(GridItem$BtsCore.make, {
                                                                                  top: "0",
                                                                                  right: "12",
                                                                                  bottom: "0",
                                                                                  left: "72",
                                                                                  xs: "auto",
                                                                                  children: React.createElement(Typography$BtsCore.make, {
                                                                                        variant: "caption",
                                                                                        color: "#606060",
                                                                                        children: item.datetime
                                                                                      })
                                                                                }))
                                                                      })
                                                                }));
                                                }), state.items)
                                        })
                                  })
                            })
                      })
                }), React.createElement(SnackbarYoutube$BtsCore.make, {
                  showYoutube: state.showYoutube,
                  position: "bottomLeft",
                  children: /* tuple */[
                    React.createElement("span", undefined, state.youtubeText),
                    null
                  ]
                }));
}

var make = Home;

export {
  reducer ,
  initialState ,
  make ,
  
}
/*  Not a pure module */
